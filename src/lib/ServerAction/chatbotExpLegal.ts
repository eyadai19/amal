export async function ChatbotExpAction(
	question: string,
	answer: string,
): Promise<
	| { question: string; answers: string[] }
	| { field: string; message: string }
	| { answer: string }
	| { answer: string; exception: string }
> {
	"use server";
	try {
		// ========== البداية: السؤال الرئيسي ==========
		if (!question) {
			return {
				question: "ما هو الهدف الذي تبحث عنه؟",
				answers: [
					"فئة الوثائق الأساسية",
					"فئة الحقوق القانونية",
					"خدمات دعم لخريجي السجون",
					"الأسئلة الشائعة",
				],
			};
		}

		// ========== فئة الوثائق الأساسية ==========
		if (
			question === "ما هو الهدف الذي تبحث عنه؟" &&
			answer === "فئة الوثائق الأساسية"
		) {
			return {
				question: "اختر نوع الوثيقة المطلوبة:",
				answers: [
					"وثائق الإفراج والسجل الجنائي",
					"وثائق السكن والعنوان",
					"وثائق العمل والتأمينات",
					"وثائق التعليم والتدريب",
					"الوثائق الشخصية الأساسية",
				],
			};
		}

		// --- وثائق الإفراج والسجل الجنائي ---
		if (
			question === "اختر نوع الوثيقة المطلوبة:" &&
			answer === "وثائق الإفراج والسجل الجنائي"
		) {
			return {
				question: "ما هي الوثيقة المتعلقة بالإفراج التي تريدها؟",
				answers: [
					"وثيقة الإفراج النهائي",
					"شهادة السوابق العدلية (عدم محكومية)",
					"إثبات انتهاء مدة العقوبة",
					"طلب إزالة القيود الأمنية",
				],
			};
		}

		if (
			question === "ما هي الوثيقة المتعلقة بالإفراج التي تريدها؟" &&
			answer === "وثيقة الإفراج النهائي"
		) {
			return {
				answer:
					"تصدر وثيقة الإفراج النهائي من إدارة السجن عند انتهاء مدة العقوبة بالكامل.",
				exception: "في حالات السجن المؤبد أو أحكام الإعدام، تختلف شروط الإفراج",
			};
		}

		if (
			question === "ما هي الوثيقة المتعلقة بالإفراج التي تريدها؟" &&
			answer === "شهادة السوابق العدلية (عدم محكومية)"
		) {
			return {
				question: "ما هو الغرض من استخراج الشهادة؟",
				answers: [
					"للوظائف الحكومية",
					"للوظائف الأمنية أو العسكرية",
					"للهجرة أو السفر",
					"أغراض أخرى",
				],
			};
		}

		if (question === "ما هو الغرض من استخراج الشهادة؟") {
			return {
				answer: answer.includes("الأمنية")
					? "تتطلب شهادة عدم محكومية من الأمن الجنائي بعد 5 سنوات من الإفراج"
					: "يمكن الحصول على شهادة السوابق العدلية بعد 3 سنوات من الإفراج لمعظم الجرائم",
				exception: "بعض الجرائم الجسيمة قد تحتاج إلى 10 سنوات أو أكثر",
			};
		}

		// --- وثائق السكن والعنوان ---
		if (
			question === "اختر نوع الوثيقة المطلوبة:" &&
			answer === "وثائق السكن والعنوان"
		) {
			return {
				question: "أي من وثائق السكن تحتاج؟",
				answers: [
					"إثبات سكن رسمي",
					"عقد إيجار مسجل",
					"طلب تغيير عنوان في السجل المدني",
					"إثبات الإقامة للمفرج عنهم",
				],
			};
		}

		if (question === "أي من وثائق السكن تحتاج؟") {
			return {
				answer:
					answer === "إثبات الإقامة للمفرج عنهم"
						? "يمكن الحصول على إثبات إقامة من المختار أو مركز الشرطة المختص"
						: `لحصول على ${answer} يجب التوجه إلى البلدية المختصة مع تقديم المستندات المطلوبة`,
				exception:
					"لا يمكن طرد المفرج عنه من سكنه بسبب سجل جنائي إلا بحكم قضائي (المادة 48 من قانون الإيجارات)",
			};
		}

		// --- وثائق العمل والتأمينات ---
		if (
			question === "اختر نوع الوثيقة المطلوبة:" &&
			answer === "وثائق العمل والتأمينات"
		) {
			return {
				question: "ما هي الوثيقة المتعلقة بالعمل التي تريدها؟",
				answers: [
					"شهادة خبرة عمل",
					"طلب توظيف للمفرج عنهم",
					"الاشتراك في الضمان الاجتماعي",
					"استخراج بطاقة عمل",
				],
			};
		}

		if (question === "ما هي الوثيقة المتعلقة بالعمل التي تريدها؟") {
			const responses = {
				"شهادة خبرة عمل":
					"يجب طلبها من جهة العمل السابقة، وفي حال رفضها يمكن التقدم بشكوى لمكتب العمل",
				"طلب توظيف للمفرج عنهم":
					"يوجد برامج خاصة لتوظيف المفرج عنهم عبر وزارة الشؤون الاجتماعية",
				"الاشتراك في الضمان الاجتماعي":
					"يمكن التسجيل في الضمان الاجتماعي عبر مكاتب العمل دون أي تمييز",
				"استخراج بطاقة عمل":
					"تصدر من مديرية العمل المختصة بعد تقديم طلب والتزامات صاحب العمل",
			};
			return {
				answer: responses[answer as keyof typeof responses],
				exception:
					answer === "طلب توظيف للمفرج عنهم"
						? "الوظائف الأمنية والعسكرية تستثنى من هذا الحق"
						: "يحظر التمييز ضد المفرج عنهم في التوظيف (المادة 60 من قانون العمل السوري)",
			};
		}

		// --- الوثائق الشخصية الأساسية ---
		if (
			question === "اختر نوع الوثيقة المطلوبة:" &&
			answer === "الوثائق الشخصية الأساسية"
		) {
			return {
				question: "أي من الوثائق الشخصية تحتاج؟",
				answers: ["هوية شخصية", "جواز سفر", "شهادة ميلاد", "بطاقة عائلة"],
			};
		}

		if (question === "أي من الوثائق الشخصية تحتاج؟") {
			const responses = {
				"هوية شخصية":
					"يمكن استخراجها من مكتب الأحوال المدنية مع صورة شخصية وبطاقة عائلة",
				"جواز سفر":
					"يتطلب موافقة أمنية للمفرج عنهم في بعض الجرائم (مدة الانتظار تختلف حسب الحالة)",
				"شهادة ميلاد": "يمكن استخراجها من السجل المدني مع إثبات الهوية",
				"بطاقة عائلة":
					"تصدر من مكتب الأحوال المدنية عند توفر جميع المستندات المطلوبة",
			};
			return {
				answer: responses[answer as keyof typeof responses],
				exception:
					answer === "جواز سفر"
						? "بعض الجرائم قد تمنع استخراج جواز سفر لمدة تصل إلى 10 سنوات"
						: "يسمح باستخراج جميع الوثائق الرسمية بعد الإفراج (المادة 48 من قانون الأحوال المدنية)",
			};
		}

		// ========== فئة الحقوق القانونية ==========
		if (
			question === "ما هو الهدف الذي تبحث عنه؟" &&
			answer === "فئة الحقوق القانونية"
		) {
			return {
				question: "اختر نوع الحق القانوني الذي تريد الاستعلام عنه:",
				answers: [
					"الحق في السكن",
					"الحق في استعادة الوثائق",
					"الحق في العمل",
					"الحق في التعليم والتدريب",
					"الحق في الرعاية الصحية",
					"الحق في التقديم على الدعم المالي",
					"الحق في إزالة القيود الأمنية",
					"الحق في الحماية من التمييز",
					"حقوق الأسرة والزيارة",
				],
			};
		}

		// --- الحق في السكن ---
		if (
			question === "اختر نوع الحق القانوني الذي تريد الاستعلام عنه:" &&
			answer === "الحق في السكن"
		) {
			return {
				answer:
					"لا يمكن حرمان المفرج عنه من حق السكن بسبب سجل جنائي (المادة 32 من قانون الإسكان).",
				exception:
					"يستثنى من ذلك إذا كان السكن مملوكاً للدولة أو مرتبطاً بالوظيفة",
			};
		}

		// --- الحق في استعادة الوثائق ---
		if (
			question === "اختر نوع الحق القانوني الذي تريد الاستعلام عنه:" &&
			answer === "الحق في استعادة الوثائق"
		) {
			return {
				answer:
					"يحق للمفرج عنه استخراج جميع الوثائق الرسمية بعد الإفراج (المادة 48 من قانون الأحوال المدنية).",
				exception: "بعض الوثائق مثل جواز السفر قد تتطلب موافقة أمنية خاصة",
			};
		}

		// --- الحق في العمل ---
		if (
			question === "اختر نوع الحق القانوني الذي تريد الاستعلام عنه:" &&
			answer === "الحق في العمل"
		) {
			return {
				question: "ما هو الجانب الذي يهمك في حق العمل؟",
				answers: [
					"الحماية من التمييز في التوظيف",
					"برامج تشغيل المفرج عنهم",
					"شروط العمل في القطاع الخاص",
					"الوظائف الحكومية المتاحة",
				],
			};
		}

		if (question === "ما هو الجانب الذي يهمك في حق العمل؟") {
			const responses = {
				"الحماية من التمييز في التوظيف":
					"يحظر القانون التمييز ضد المفرج عنهم في التوظيف (المادة 60 من قانون العمل السوري)",
				"برامج تشغيل المفرج عنهم":
					"يوجد برامج خاصة عبر وزارة الشؤون الاجتماعية ومراكز الإصلاح والتأهيل",
				"شروط العمل في القطاع الخاص":
					"لا توجد قيود على عمل المفرج عنهم في القطاع الخاص إلا في بعض المهن الحساسة",
				"الوظائف الحكومية المتاحة":
					"يمكن للمفرج عنهم العمل في معظم الوظائف الحكومية بعد مرور 3 سنوات من الإفراج",
			};
			return {
				answer: responses[answer as keyof typeof responses],
				exception: "الوظائف الأمنية والعسكرية تتطلب شهادة عدم محكومية",
			};
		}

		// --- الحق في التعليم والتدريب ---
		if (
			question === "اختر نوع الحق القانوني الذي تريد الاستعلام عنه:" &&
			answer === "الحق في التعليم والتدريب"
		) {
			return {
				question: "ما هو نوع التعليم أو التدريب الذي تبحث عنه؟",
				answers: [
					"التسجيل في المدارس والجامعات",
					"مراكز التدريب المهني",
					"برامج محو الأمية",
					"منح دراسية للمفرج عنهم",
				],
			};
		}

		if (question === "ما هو نوع التعليم أو التدريب الذي تبحث عنه؟") {
			const responses = {
				"التسجيل في المدارس والجامعات":
					"يسمح بالتسجيل في جميع المراكز التعليمية الحكومية دون تمييز (المادة 28 من الدستور)",
				"مراكز التدريب المهني":
					"توجد مراكز تدريب مهني خاصة بالمفرج عنهم تابعة لوزارة الشؤون الاجتماعية",
				"برامج محو الأمية":
					"برامج مجانية متاحة في مراكز الإصلاح والتأهيل ومراكز محو الأمية",
				"منح دراسية للمفرج عنهم":
					"يوجد عدد محدود من المنح الدراسية المقدمة من منظمات المجتمع المدني",
			};
			return {
				answer: responses[answer as keyof typeof responses],
				exception: "بعض التخصصات العسكرية والأمنية قد تكون مقيدة",
			};
		}

		// --- الحق في الرعاية الصحية ---
		if (
			question === "اختر نوع الحق القانوني الذي تريد الاستعلام عنه:" &&
			answer === "الحق في الرعاية الصحية"
		) {
			return {
				question: "ما هو الجانب الصحي الذي يهمك؟",
				answers: [
					"التأمين الصحي للمفرج عنهم",
					"مراكز العلاج النفسي والتأهيل",
					"علاج الإدمان",
					"الرعاية الصحية المجانية",
				],
			};
		}

		if (question === "ما هو الجانب الصحي الذي يهمك؟") {
			const responses = {
				"التأمين الصحي للمفرج عنهم":
					"يمكن التسجيل في التأمين الصحي عبر مكاتب الضمان الاجتماعي",
				"مراكز العلاج النفسي والتأهيل":
					"توجد مراكز حكومية وخاصة متخصصة في التأهيل النفسي لخريجي السجون",
				"علاج الإدمان":
					"برامج مجانية لعلاج الإدمان متاحة في المستشفيات الحكومية",
				"الرعاية الصحية المجانية":
					"يتمتع المفرج عنهم بحق العلاج المجاني في المستشفيات الحكومية لمدة 6 أشهر بعد الإفراج",
			};
			return {
				answer: responses[answer as keyof typeof responses],
				exception: "بعض الخدمات المتخصصة قد تحتاج إلى موافقة أمنية",
			};
		}

		// ========== خدمات دعم لخريجي السجون ==========
		if (
			question === "ما هو الهدف الذي تبحث عنه؟" &&
			answer === "خدمات دعم لخريجي السجون"
		) {
			return {
				question: "ما نوع الدعم الذي تبحث عنه؟",
				answers: [
					"الدعم النفسي والاجتماعي",
					"برامج إعادة التأهيل",
					"مساعدات مالية وإيوائية",
					"دعم قانوني واستشاري",
					"برامج حماية الشهود",
				],
			};
		}

		if (question === "ما نوع الدعم الذي تبحث عنه؟") {
			const responses = {
				"الدعم النفسي والاجتماعي":
					"توجد عيادات نفسية متخصصة في مراكز الإصلاح والتأهيل توفر جلسات دعم نفسي مجانية",
				"برامج إعادة التأهيل":
					"برامج مهنية وتدريبية لمدة 6 أشهر تشمل سكنًا ومصروفًا شهريًا",
				"مساعدات مالية وإيوائية":
					"منح مالية لمرة واحدة تصل إلى 500 ألف ليرة سورية، ومراكز إيواء مؤقتة",
				"دعم قانوني واستشاري":
					"عيادات قانونية مجانية تقدم استشارات وتتبع القضايا",
				"برامج حماية الشهود":
					"حماية خاصة للمفرج عنهم الذين يشكلون شهودًا في قضايا هامة",
			};
			return {
				answer: responses[answer as keyof typeof responses],
				exception:
					"بعض الخدمات قد تتطلب موافقة من إدارة السجون أو النيابة العامة",
			};
		}

		// ========== الأسئلة الشائعة ==========
		if (
			question === "ما هو الهدف الذي تبحث عنه؟" &&
			answer === "الأسئلة الشائعة"
		) {
			return {
				question: "اختر سؤالاً من الأسئلة الشائعة:",
				answers: [
					"كيف أزيل اسمي من القوائم السوداء؟",
					"هل يمكنني السفر بعد الإفراج؟",
					"كيف أحصل على مسكن مؤقت؟",
					"ما هي حقوقي إذا تعرضت للتمييز؟",
					"كيف أستعيد حضانة أطفالي؟",
				],
			};
		}

		if (question === "اختر سؤالاً من الأسئلة الشائعة:") {
			const responses = {
				"كيف أزيل اسمي من القوائم السوداء؟":
					"تقديم طلب إلى الأمن الجنائي بعد مرور المدة القانونية (3-10 سنوات حسب الجريمة)",
				"هل يمكنني السفر بعد الإفراج؟":
					"نعم، بعد الحصول على جواز سفر وموافقة أمنية إذا كانت الجريمة من الجرائم المقيدة للسفر",
				"كيف أحصل على مسكن مؤقت؟":
					"التوجه إلى مراكز الإيواء التابعة لوزارة الشؤون الاجتماعية أو الجمعيات الخيرية",
				"ما هي حقوقي إذا تعرضت للتمييز؟":
					"يمكنك رفع دعوى قضائية بموجب المادة 479 من قانون العقوبات",
				"كيف أستعيد حضانة أطفالي؟":
					"تقديم طلب إلى محكمة الأسرة المختصة مع إثبات القدرة على الرعاية",
			};
			return {
				answer: responses[answer as keyof typeof responses],
				exception:
					answer === "هل يمكنني السفر بعد الإفراج؟"
						? "بعض الجرائم الإرهابية أو الجسيمة قد تمنع السفر مدى الحياة"
						: undefined,
			};
		}

		// === معالجة الأخطاء ===
		return {
			field: "error",
			message: "إدخال غير صحيح. يرجى اختيار أحد الخيارات المعروضة.",
		};
	} catch (error) {
		return {
			field: "error",
			message: "حدث خطأ في النظام. يرجى المحاولة لاحقاً.",
		};
	}
}
